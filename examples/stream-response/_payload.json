[{"data":1,"prerenderedAt":847},["ShallowReactive",2],{"navigation":3,"-examples-stream-response":185,"-examples-stream-response-surround":842},[4,91,133,161,168],{"title":5,"path":6,"stem":7,"children":8,"icon":90},"Guide","/guide","1.guide/0.index",[9,12,53,69],{"title":10,"path":6,"stem":7,"icon":11},"入门指南","pixel:play",{"title":5,"icon":13,"path":14,"stem":15,"children":16,"page":52},"ph:book-open-duotone","/guide/basics","1.guide/1.basics",[17,22,27,32,37,42,47],{"title":18,"path":19,"stem":20,"icon":21},"请求生命周期","/guide/basics/lifecycle","1.guide/1.basics/1.lifecycle","icon-park-outline:handle-round",{"title":23,"path":24,"stem":25,"icon":26},"路由","/guide/basics/routing","1.guide/1.basics/2.routing","solar:routing-bold",{"title":28,"path":29,"stem":30,"icon":31},"中间件","/guide/basics/middleware","1.guide/1.basics/3.middleware","mdi:middleware-outline",{"title":33,"path":34,"stem":35,"icon":36},"事件处理器","/guide/basics/handler","1.guide/1.basics/4.handler","mdi:function",{"title":38,"path":39,"stem":40,"icon":41},"发送响应","/guide/basics/response","1.guide/1.basics/5.response","tabler:json",{"title":43,"path":44,"stem":45,"icon":46},"错误处理","/guide/basics/error","1.guide/1.basics/6.error","tabler:error-404",{"title":48,"path":49,"stem":50,"icon":51},"嵌套应用","/guide/basics/nested-apps","1.guide/1.basics/7.nested-apps","material-symbols-light:layers-outline",false,{"title":54,"icon":55,"path":56,"stem":57,"children":58,"page":52},"API","material-symbols-light:api-rounded","/guide/api","1.guide/900.api",[59,64],{"title":60,"path":61,"stem":62,"icon":63},"H3","/guide/api/h3","1.guide/900.api/1.h3","material-symbols:bolt-rounded",{"title":65,"path":66,"stem":67,"icon":68},"H3Event","/guide/api/h3event","1.guide/900.api/2.h3event","material-symbols:data-object-rounded",{"title":70,"icon":71,"path":72,"stem":73,"children":74,"page":52},"Advanced","hugeicons:more-01","/guide/advanced","1.guide/901.advanced",[75,80,85],{"title":76,"path":77,"stem":78,"icon":79},"Plugins","/guide/advanced/plugins","1.guide/901.advanced/1.plugins","clarity:plugin-line",{"title":81,"path":82,"stem":83,"icon":84},"WebSockets","/guide/advanced/websocket","1.guide/901.advanced/2.websocket","hugeicons:live-streaming-02",{"title":86,"path":87,"stem":88,"icon":89},"每夜构建","/guide/advanced/nightly","1.guide/901.advanced/9.nightly","game-icons:barn-owl","i-ph:book-open-duotone",{"title":92,"path":93,"stem":94,"children":95,"icon":97},"H3 工具集","/utils","2.utils/0.index",[96,98,103,108,113,118,123,128],{"title":92,"path":93,"stem":94,"icon":97},"ph:function-bold",{"title":99,"path":100,"stem":101,"icon":102},"请求","/utils/request","2.utils/1.request","material-symbols-light:input",{"title":104,"path":105,"stem":106,"icon":107},"响应","/utils/response","2.utils/2.response","material-symbols-light:output",{"title":109,"path":110,"stem":111,"icon":112},"Cookie","/utils/cookie","2.utils/3.cookie","material-symbols:cookie-outline",{"title":114,"path":115,"stem":116,"icon":117},"安全","/utils/security","2.utils/4.security","wpf:key-security",{"title":119,"path":120,"stem":121,"icon":122},"代理","/utils/proxy","2.utils/5.proxy","arcticons:super-proxy",{"title":124,"path":125,"stem":126,"icon":127},"更多工具","/utils/more","2.utils/9.more","mingcute:plus-line",{"title":129,"path":130,"stem":131,"icon":132},"社区","/utils/community","2.utils/99.community","lets-icons:external",{"title":134,"path":135,"stem":136,"children":137,"icon":139},"示例","/examples","4.examples/0.index",[138,140,145,149,153,157],{"title":134,"path":135,"stem":136,"icon":139},"ph:code",{"title":141,"path":142,"stem":143,"icon":144},"Cookies","/examples/handle-cookie","4.examples/handle-cookie","ph:arrow-right",{"title":146,"path":147,"stem":148,"icon":144},"会话","/examples/handle-session","4.examples/handle-session",{"title":150,"path":151,"stem":152,"icon":144},"静态资源","/examples/serve-static-assets","4.examples/serve-static-assets",{"title":154,"path":155,"stem":156,"icon":144},"流式响应","/examples/stream-response","4.examples/stream-response",{"title":158,"path":159,"stem":160,"icon":144},"验证数据","/examples/validate-data","4.examples/validate-data",{"title":162,"path":163,"stem":164,"children":165,"icon":167},"从 v1 到 v2 的迁移指南","/migration","5.migration/0.index",[166],{"title":162,"path":163,"stem":164,"icon":167},"icons8:up-round",{"title":169,"path":170,"stem":171,"children":172,"page":-1},"Blog","/blog","99.blog",[173,177,181],{"title":174,"path":170,"stem":175,"icon":176},"博客","99.blog/index","i-lucide-file-text",{"title":178,"path":179,"stem":180,"icon":176},"H3 1.8 - 迈向 Web 的边缘","/blog/v1.8","99.blog/1.v1.8",{"title":182,"path":183,"stem":184,"icon":176},"H3 v2 测试版","/blog/v2-beta","99.blog/2.v2-beta",{"id":186,"title":154,"body":187,"description":836,"extension":837,"meta":838,"navigation":839,"path":155,"seo":840,"stem":156,"__hash__":841},"content/4.examples/stream-response.md",{"type":188,"value":189,"toc":832,"icon":144},"minimark",[190,194,198,212,248,251,481,484,817,825,828],[191,192,193],"p",{},"使用流式响应可以让你在获取数据后立即发送给客户端。这对于大文件或长时间运行的响应非常有用。",[195,196,197],"h2",{"id":197},"创建一个流",[191,199,200,201,211],{},"要进行流式响应，首先需要使用 ",[202,203,207],"a",{"href":204,"rel":205},"https://developer.mozilla.org/en-US/docs/Web/API/ReadableStream",[206],"nofollow",[208,209,210],"code",{},"ReadableStream"," API 创建一个流：",[213,214,219],"pre",{"className":215,"code":216,"language":217,"meta":218,"style":218},"language-ts shiki shiki-themes github-light github-dark github-dark","const stream = new ReadableStream();\n","ts","",[208,220,221],{"__ignoreMap":218},[222,223,226,230,234,237,240,244],"span",{"class":224,"line":225},"line",1,[222,227,229],{"class":228},"so5gQ","const",[222,231,233],{"class":232},"suiK_"," stream",[222,235,236],{"class":228}," =",[222,238,239],{"class":228}," new",[222,241,243],{"class":242},"shcOC"," ReadableStream",[222,245,247],{"class":246},"slsVL","();\n",[191,249,250],{},"在示例中，我们将创建一个 start 函数，每 100 毫秒发送一个随机数。1000 毫秒后关闭流：",[213,252,254],{"className":215,"code":253,"language":217,"meta":218,"style":218},"let interval: NodeJS.Timeout;\nconst stream = new ReadableStream({\n  start(controller) {\n    controller.enqueue(\"\u003Cul>\");\n\n    interval = setInterval(() => {\n      controller.enqueue(\"\u003Cli>\" + Math.random() + \"\u003C/li>\");\n    }, 100);\n\n    setTimeout(() => {\n      clearInterval(interval);\n      controller.close();\n    }, 1000);\n  },\n  cancel() {\n    clearInterval(interval);\n  },\n});\n",[208,255,256,279,295,311,329,336,357,390,401,406,418,427,437,447,453,462,470,475],{"__ignoreMap":218},[222,257,258,261,264,267,270,273,276],{"class":224,"line":225},[222,259,260],{"class":228},"let",[222,262,263],{"class":246}," interval",[222,265,266],{"class":228},":",[222,268,269],{"class":242}," NodeJS",[222,271,272],{"class":246},".",[222,274,275],{"class":242},"Timeout",[222,277,278],{"class":246},";\n",[222,280,282,284,286,288,290,292],{"class":224,"line":281},2,[222,283,229],{"class":228},[222,285,233],{"class":232},[222,287,236],{"class":228},[222,289,239],{"class":228},[222,291,243],{"class":242},[222,293,294],{"class":246},"({\n",[222,296,298,301,304,308],{"class":224,"line":297},3,[222,299,300],{"class":242},"  start",[222,302,303],{"class":246},"(",[222,305,307],{"class":306},"sQHwn","controller",[222,309,310],{"class":246},") {\n",[222,312,314,317,320,322,326],{"class":224,"line":313},4,[222,315,316],{"class":246},"    controller.",[222,318,319],{"class":242},"enqueue",[222,321,303],{"class":246},[222,323,325],{"class":324},"sfrk1","\"\u003Cul>\"",[222,327,328],{"class":246},");\n",[222,330,332],{"class":224,"line":331},5,[222,333,335],{"emptyLinePlaceholder":334},true,"\n",[222,337,339,342,345,348,351,354],{"class":224,"line":338},6,[222,340,341],{"class":246},"    interval ",[222,343,344],{"class":228},"=",[222,346,347],{"class":242}," setInterval",[222,349,350],{"class":246},"(() ",[222,352,353],{"class":228},"=>",[222,355,356],{"class":246}," {\n",[222,358,360,363,365,367,370,373,376,379,382,385,388],{"class":224,"line":359},7,[222,361,362],{"class":246},"      controller.",[222,364,319],{"class":242},[222,366,303],{"class":246},[222,368,369],{"class":324},"\"\u003Cli>\"",[222,371,372],{"class":228}," +",[222,374,375],{"class":246}," Math.",[222,377,378],{"class":242},"random",[222,380,381],{"class":246},"() ",[222,383,384],{"class":228},"+",[222,386,387],{"class":324}," \"\u003C/li>\"",[222,389,328],{"class":246},[222,391,393,396,399],{"class":224,"line":392},8,[222,394,395],{"class":246},"    }, ",[222,397,398],{"class":232},"100",[222,400,328],{"class":246},[222,402,404],{"class":224,"line":403},9,[222,405,335],{"emptyLinePlaceholder":334},[222,407,409,412,414,416],{"class":224,"line":408},10,[222,410,411],{"class":242},"    setTimeout",[222,413,350],{"class":246},[222,415,353],{"class":228},[222,417,356],{"class":246},[222,419,421,424],{"class":224,"line":420},11,[222,422,423],{"class":242},"      clearInterval",[222,425,426],{"class":246},"(interval);\n",[222,428,430,432,435],{"class":224,"line":429},12,[222,431,362],{"class":246},[222,433,434],{"class":242},"close",[222,436,247],{"class":246},[222,438,440,442,445],{"class":224,"line":439},13,[222,441,395],{"class":246},[222,443,444],{"class":232},"1000",[222,446,328],{"class":246},[222,448,450],{"class":224,"line":449},14,[222,451,452],{"class":246},"  },\n",[222,454,456,459],{"class":224,"line":455},15,[222,457,458],{"class":242},"  cancel",[222,460,461],{"class":246},"() {\n",[222,463,465,468],{"class":224,"line":464},16,[222,466,467],{"class":242},"    clearInterval",[222,469,426],{"class":246},[222,471,473],{"class":224,"line":472},17,[222,474,452],{"class":246},[222,476,478],{"class":224,"line":477},18,[222,479,480],{"class":246},"});\n",[195,482,483],{"id":483},"发送流",[213,485,487],{"className":215,"code":486,"language":217,"meta":218,"style":218},"import { H3, setResponseHeader } from \"h3\";\n\nexport const app = new H3();\n\napp.use((event) => {\n  // 设置响应头，告知客户端我们正在发送一个流。\n  setResponseHeader(event, \"Content-Type\", \"text/html\");\n  setResponseHeader(event, \"Cache-Control\", \"no-cache\");\n  setResponseHeader(event, \"Transfer-Encoding\", \"chunked\");\n\n  let interval: NodeJS.Timeout;\n  const stream = new ReadableStream({\n    start(controller) {\n      controller.enqueue(\"\u003Cul>\");\n\n      interval = setInterval(() => {\n        controller.enqueue(\"\u003Cli>\" + Math.random() + \"\u003C/li>\");\n      }, 100);\n\n      setTimeout(() => {\n        clearInterval(interval);\n        controller.close();\n      }, 1000);\n    },\n    cancel() {\n      clearInterval(interval);\n    },\n  });\n\n  return stream;\n});\n",[208,488,489,505,509,529,533,554,560,579,595,611,615,632,647,658,670,674,689,714,723,728,740,748,757,766,772,780,787,792,798,803,812],{"__ignoreMap":218},[222,490,491,494,497,500,503],{"class":224,"line":225},[222,492,493],{"class":228},"import",[222,495,496],{"class":246}," { H3, setResponseHeader } ",[222,498,499],{"class":228},"from",[222,501,502],{"class":324}," \"h3\"",[222,504,278],{"class":246},[222,506,507],{"class":224,"line":281},[222,508,335],{"emptyLinePlaceholder":334},[222,510,511,514,517,520,522,524,527],{"class":224,"line":297},[222,512,513],{"class":228},"export",[222,515,516],{"class":228}," const",[222,518,519],{"class":232}," app",[222,521,236],{"class":228},[222,523,239],{"class":228},[222,525,526],{"class":242}," H3",[222,528,247],{"class":246},[222,530,531],{"class":224,"line":313},[222,532,335],{"emptyLinePlaceholder":334},[222,534,535,538,541,544,547,550,552],{"class":224,"line":331},[222,536,537],{"class":246},"app.",[222,539,540],{"class":242},"use",[222,542,543],{"class":246},"((",[222,545,546],{"class":306},"event",[222,548,549],{"class":246},") ",[222,551,353],{"class":228},[222,553,356],{"class":246},[222,555,556],{"class":224,"line":338},[222,557,559],{"class":558},"sCsY4","  // 设置响应头，告知客户端我们正在发送一个流。\n",[222,561,562,565,568,571,574,577],{"class":224,"line":359},[222,563,564],{"class":242},"  setResponseHeader",[222,566,567],{"class":246},"(event, ",[222,569,570],{"class":324},"\"Content-Type\"",[222,572,573],{"class":246},", ",[222,575,576],{"class":324},"\"text/html\"",[222,578,328],{"class":246},[222,580,581,583,585,588,590,593],{"class":224,"line":392},[222,582,564],{"class":242},[222,584,567],{"class":246},[222,586,587],{"class":324},"\"Cache-Control\"",[222,589,573],{"class":246},[222,591,592],{"class":324},"\"no-cache\"",[222,594,328],{"class":246},[222,596,597,599,601,604,606,609],{"class":224,"line":403},[222,598,564],{"class":242},[222,600,567],{"class":246},[222,602,603],{"class":324},"\"Transfer-Encoding\"",[222,605,573],{"class":246},[222,607,608],{"class":324},"\"chunked\"",[222,610,328],{"class":246},[222,612,613],{"class":224,"line":408},[222,614,335],{"emptyLinePlaceholder":334},[222,616,617,620,622,624,626,628,630],{"class":224,"line":420},[222,618,619],{"class":228},"  let",[222,621,263],{"class":246},[222,623,266],{"class":228},[222,625,269],{"class":242},[222,627,272],{"class":246},[222,629,275],{"class":242},[222,631,278],{"class":246},[222,633,634,637,639,641,643,645],{"class":224,"line":429},[222,635,636],{"class":228},"  const",[222,638,233],{"class":232},[222,640,236],{"class":228},[222,642,239],{"class":228},[222,644,243],{"class":242},[222,646,294],{"class":246},[222,648,649,652,654,656],{"class":224,"line":439},[222,650,651],{"class":242},"    start",[222,653,303],{"class":246},[222,655,307],{"class":306},[222,657,310],{"class":246},[222,659,660,662,664,666,668],{"class":224,"line":449},[222,661,362],{"class":246},[222,663,319],{"class":242},[222,665,303],{"class":246},[222,667,325],{"class":324},[222,669,328],{"class":246},[222,671,672],{"class":224,"line":455},[222,673,335],{"emptyLinePlaceholder":334},[222,675,676,679,681,683,685,687],{"class":224,"line":464},[222,677,678],{"class":246},"      interval ",[222,680,344],{"class":228},[222,682,347],{"class":242},[222,684,350],{"class":246},[222,686,353],{"class":228},[222,688,356],{"class":246},[222,690,691,694,696,698,700,702,704,706,708,710,712],{"class":224,"line":472},[222,692,693],{"class":246},"        controller.",[222,695,319],{"class":242},[222,697,303],{"class":246},[222,699,369],{"class":324},[222,701,372],{"class":228},[222,703,375],{"class":246},[222,705,378],{"class":242},[222,707,381],{"class":246},[222,709,384],{"class":228},[222,711,387],{"class":324},[222,713,328],{"class":246},[222,715,716,719,721],{"class":224,"line":477},[222,717,718],{"class":246},"      }, ",[222,720,398],{"class":232},[222,722,328],{"class":246},[222,724,726],{"class":224,"line":725},19,[222,727,335],{"emptyLinePlaceholder":334},[222,729,731,734,736,738],{"class":224,"line":730},20,[222,732,733],{"class":242},"      setTimeout",[222,735,350],{"class":246},[222,737,353],{"class":228},[222,739,356],{"class":246},[222,741,743,746],{"class":224,"line":742},21,[222,744,745],{"class":242},"        clearInterval",[222,747,426],{"class":246},[222,749,751,753,755],{"class":224,"line":750},22,[222,752,693],{"class":246},[222,754,434],{"class":242},[222,756,247],{"class":246},[222,758,760,762,764],{"class":224,"line":759},23,[222,761,718],{"class":246},[222,763,444],{"class":232},[222,765,328],{"class":246},[222,767,769],{"class":224,"line":768},24,[222,770,771],{"class":246},"    },\n",[222,773,775,778],{"class":224,"line":774},25,[222,776,777],{"class":242},"    cancel",[222,779,461],{"class":246},[222,781,783,785],{"class":224,"line":782},26,[222,784,423],{"class":242},[222,786,426],{"class":246},[222,788,790],{"class":224,"line":789},27,[222,791,771],{"class":246},[222,793,795],{"class":224,"line":794},28,[222,796,797],{"class":246},"  });\n",[222,799,801],{"class":224,"line":800},29,[222,802,335],{"emptyLinePlaceholder":334},[222,804,806,809],{"class":224,"line":805},30,[222,807,808],{"class":228},"  return",[222,810,811],{"class":246}," stream;\n",[222,813,815],{"class":224,"line":814},31,[222,816,480],{"class":246},[191,818,819,820,824],{},"打开浏览器访问 ",[202,821,822],{"href":822,"rel":823},"http://localhost:3000",[206]," ，你应该会看到每 100 毫秒出现一个随机数列表。",[191,826,827],{},"神奇！🎉",[829,830,831],"style",{},"html pre.shiki code .so5gQ, html code.shiki .so5gQ{--shiki-light:#D73A49;--shiki-default:#F97583;--shiki-dark:#F97583}html pre.shiki code .suiK_, html code.shiki .suiK_{--shiki-light:#005CC5;--shiki-default:#79B8FF;--shiki-dark:#79B8FF}html pre.shiki code .shcOC, html code.shiki .shcOC{--shiki-light:#6F42C1;--shiki-default:#B392F0;--shiki-dark:#B392F0}html pre.shiki code .slsVL, html code.shiki .slsVL{--shiki-light:#24292E;--shiki-default:#E1E4E8;--shiki-dark:#E1E4E8}html .light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html.light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html pre.shiki code .sQHwn, html code.shiki .sQHwn{--shiki-light:#E36209;--shiki-default:#FFAB70;--shiki-dark:#FFAB70}html pre.shiki code .sfrk1, html code.shiki .sfrk1{--shiki-light:#032F62;--shiki-default:#9ECBFF;--shiki-dark:#9ECBFF}html pre.shiki code .sCsY4, html code.shiki .sCsY4{--shiki-light:#6A737D;--shiki-default:#6A737D;--shiki-dark:#6A737D}",{"title":218,"searchDepth":281,"depth":281,"links":833},[834,835],{"id":197,"depth":281,"text":197},{"id":483,"depth":281,"text":483},"向客户端进行流式响应。","md",{"icon":144},{"icon":144},{"title":154,"description":836},"35wW2G-DZlouNMUGfkPajRHpSRNdqbzBfAbGw2o4ajE",[843,845],{"title":150,"path":151,"stem":152,"description":844,"icon":144,"children":-1},"提供静态资源服务，例如 HTML、图片、CSS、JavaScript 等。",{"title":158,"path":159,"stem":160,"description":846,"icon":144,"children":-1},"在处理数据之前，确保您的数据是有效且安全的。",1757861511096]