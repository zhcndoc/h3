---
icon: solar:route-linear
---

## 添加路由

H3 应用实例内置了一个路由系统，用于注册匹配带有参数或特定 HTTP 方法的路由模式。

::tip
路由由 [🌳 rou3](https://github.com/h3js/rou3) 提供支持，它是一款超快且轻量的路由匹配引擎。
::

**示例：** 注册一个路由，匹配使用 HTTP **GET** 方法访问 `/hello` 端点的请求：

```js
// 方法一：使用 app.[method]
app.get("/hello", () => "Hello world!");

// 方法二：使用 app.on(method)
app.on("GET", "/hello", () => "Hello world!");
```

你可以为同一路由注册多个不同方法的事件处理器：

```js
app
  .get("/hello", () => "GET Hello world!")
  .post("/hello", () => "POST Hello world!");
```

你也可以使用 `app.all` 方法注册一个接受任何 HTTP 方法的路由：

```js
app.all("/hello", (event) => `This is a ${event.req.method} request!`);
```

### 路由参数

你可以通过 `:` 前缀来定义路由中的参数：

```js
app.get("/hello/:name", (event) => {
  return `Hello ${event.context.params.name}!`;
});
```

在此示例中，`name` 参数将可通过 `event.context.params` 对象访问。

如果请求地址是 `/hello/world`，事件处理器将响应 `Hello world!`。

除了命名参数，你也可以使用 `*` 表示未命名且**可选**的参数：

```js
app.get("/hello/*", (event) => `Hello!`);
```

### 通配参数

添加 `/hello/:name` 路由会匹配 `/hello/world` 或 `/hello/123`，但不会匹配 `/hello/foo/bar`。

如果你需要匹配多级子路由，可以使用 `**` 前缀：

```js
app.get("/hello/**", (event) => `Hello ${event.context.params._}!`);
```

这将匹配 `/hello`、`/hello/world`、`/hello/123`、`/hello/world/123` 等。

> [!NOTE]
> 参数 `_` 会存储完整的通配符内容，作为一个字符串。

## 添加中间件

你可以使用 `app.use` 向应用实例注册[中间件处理器](/guide/handler#middleware)。

**示例：** 注册全局中间件，对每个路由调用。

```js
app.use((event) => {
  console.log(event);
});
```

**示例：** 注册匹配以 `/blog` 前缀开头的特定路由且使用 `GET` 方法的中间件（如 `/blog/`、`/blog/world`、`/blog/123` 等）。

```js
app.use(
  (event) => {
    console.log(event);
  },
  { route: "/blog/**", method: "GET" },
);
```

你可以定义多个中间件。

```js
app.use(() => "First");
app.use(() => "Second");
```

上述示例中，第一个事件处理器会调用于每个请求，且**第二个永远不会被调用**。

不过，如果第一个事件处理器不返回响应，第二个中间件才会被调用。这在实现 _中间件_ 模式时非常有用。

```js
app.use((event) => {
  console.log("First");
});

app.use((event) => {
  console.log("Second");
});
```

如果所有处理器都被调用且没有返回响应，h3 会继续执行主路由处理器。

你也可以注册带有 `next` 参数的中间件，以拦截后续中间件或处理器的返回值：

```js
app.use(async (event, next) => {
  const rawResponse = await next();
  // [拦截响应]
  return rawResponse;
});
```

你还可以注册匹配特定要求的中间件：

```js
app.use(
  (event, next) => {
    console.log("[alert] POST 请求访问 /blog 路径！");
  },
  {
    method: "POST",
    route: "/blog/**",
    // match: (event) => event.req.method === "POST", // 与 method: "POST" 等价
  },
);
```

在添加路由时，你可以注册随路由一起运行的中间件：

```js
app.get("/admin", (event) => {}, [auth]);
```