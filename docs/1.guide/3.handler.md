---
icon: fluent:target-24-regular
---

# äº‹ä»¶å¤„ç†å™¨

> äº‹ä»¶å¤„ç†å™¨å®šä¹‰åº”ç”¨é€»è¾‘ã€‚

åœ¨åˆ›å»ºä¸€ä¸ª [h3 åº”ç”¨å®žä¾‹](/guide/app) åŽï¼Œä½ å¯ä»¥å¼€å§‹ä½¿ç”¨äº‹ä»¶å¤„ç†å™¨æ¥å®šä¹‰ä½ çš„åº”ç”¨é€»è¾‘ã€‚

äº‹ä»¶å¤„ç†å™¨æ˜¯ä¸€ä¸ªæŽ¥æ”¶ [H3Event](/guide/event) ä¸Šä¸‹æ–‡å¹¶è¿”å›žå“åº”çš„å‡½æ•°ã€‚

## å®šä¹‰äº‹ä»¶å¤„ç†å™¨

ä½ å¯ä»¥ä½¿ç”¨ `defineEventHandler` æ¥å®šä¹‰ç±»åž‹åŒ–çš„äº‹ä»¶å¤„ç†å™¨ã€‚

> [!NOTE]
> ä½¿ç”¨ `defineEventHandler` æ˜¯å¯é€‰çš„ã€‚å½“ä½¿ç”¨ [app æ–¹æ³•](/guide/app#h3-methods) æ³¨å†Œè·¯ç”±æˆ–ä¸­é—´ä»¶æ—¶ï¼Œç±»åž‹æç¤ºä¾ç„¶å¯ç”¨ã€‚

```js
import { defineEventHandler } from "h3";

defineEventHandler((event) => "Response");
```

å›žè°ƒå‡½æ•°å¯ä»¥æ˜¯åŒæ­¥æˆ–å¼‚æ­¥çš„ï¼š

```js
defineEventHandler(async (event) => "Response");
```

ä½ ä¹Ÿå¯ä»¥é€‰æ‹©æ³¨å†Œä¸€äº› [ä¸­é—´ä»¶](#middleware)ï¼Œä¸Žäº‹ä»¶å¤„ç†å™¨ä¸€èµ·è¿è¡Œï¼Œä»¥æ‹¦æˆªè¯·æ±‚ã€å“åº”æˆ–é”™è¯¯ã€‚

```js
defineEventHandler((event) => {}, [auth]);
```

## å“åº”ç±»åž‹

äº‹ä»¶å¤„ç†å™¨è¿”å›žçš„å€¼ä¼šè‡ªåŠ¨è½¬æ¢ä¸º HTTP å“åº”ã€‚

å¦‚æžœäº‹ä»¶å¤„ç†å™¨è¿”å›žçš„æ˜¯ä¸€ä¸ª [Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise) æˆ–æ¥è‡ª [å¼‚æ­¥å‡½æ•°](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function)ï¼Œh3 ä¼šç­‰å¾…å®ƒè§£æžåŽå†å‘é€å“åº”ã€‚

### `null` æˆ– `undefined`

åœ¨ [è·¯ç”±å¤„ç†å™¨](/guide/routing#adding-routes) ä¸­å‘é€ä¸€ä¸ªç©ºå“åº”ä½“ï¼Œåœ¨ [ä¸­é—´ä»¶å¤„ç†å™¨](/guide/routing#adding-middleware) ä¸­åˆ™ä¼šè¿›å…¥ä¸‹ä¸€ä¸ªå¤„ç†å™¨ã€‚

> [!TIP]
> å¦‚æžœäº‹ä»¶å¤„ç†å™¨ä¸­æ²¡æœ‰ `return` è¯­å¥ï¼Œè¿™ç­‰åŒäºŽ `return undefined`ã€‚

### å­—ç¬¦ä¸²

è¿”å›žä¸€ä¸ªå­—ç¬¦ä¸²å€¼ä¼šä½œä¸ºçº¯æ–‡æœ¬ä½“å‘é€ã€‚

> [!NOTE]
> å¦‚æžœæ²¡æœ‰è®¾ç½® `content-type`ï¼Œé»˜è®¤ä¸º `text/plain;charset=UTF-8`ã€‚

**ç¤ºä¾‹ï¼š** å‘é€ HTML å“åº”

```ts
app.get("/", (event) => {
  event.res.headers.set("Content-Type", "text/html;charset=UTF-8");
  return "<h1>hello world</h1>";
});
```

### å¯ JSON åºåˆ—åŒ–çš„å€¼

è¿”å›žä¸€ä¸ª [JSON](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON) å¯åºåˆ—åŒ–çš„å€¼ï¼ˆ**å¯¹è±¡**ã€**æ•°ç»„**ã€**æ•°å­—** æˆ– **å¸ƒå°”å€¼**ï¼‰æ—¶ï¼Œä¼šä½¿ç”¨ [JSON.stringify()](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify) è¿›è¡Œå­—ç¬¦ä¸²åŒ–ï¼Œå¹¶ä»¥é»˜è®¤çš„ `application/json` ç±»åž‹å‘é€ã€‚

**ç¤ºä¾‹ï¼š**

```ts
app.get("/", (event) => ({ hello: "world" }));
```

> [!TIP]
> ä½ å¯ä»¥åœ¨å¯¹è±¡ä¸­æ·»åŠ  `toJSON()` æ–¹æ³•æ¥è‡ªå®šä¹‰åºåˆ—åŒ–è¡Œä¸ºã€‚æ›´å¤šä¿¡æ¯è¯·æŸ¥çœ‹ [MDN æ–‡æ¡£](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify)ã€‚

### `Response`

å‘é€æ ‡å‡† Web [Response](https://developer.mozilla.org/en-US/docs/Web/API/Response/Response)ã€‚

**ç¤ºä¾‹ï¼š**

```ts
app.get("/", (event) => Response.json({ hello: "world" }));
```

> [!NOTE]
> å‘é€ `Response` æ—¶ï¼Œä»¥å‰é€šè¿‡ `event.res.headers` è®¾ç½®çš„ä»»ä½•å¤´éƒ¨å°†ä½œä¸ºé»˜è®¤å¤´éƒ¨åˆå¹¶ã€‚`event.res.{status/statusText}` ä¼šè¢«å¿½ç•¥ã€‚  
> ä¸ºäº†æ€§èƒ½è€ƒè™‘ï¼Œæœ€å¥½ä»…åœ¨æœ€ç»ˆ `Response` é‡Œè®¾ç½®å¤´éƒ¨ã€‚

### `ReadableStream` æˆ– `Readable`

å‘é€æ ‡å‡† Web [ReadableStream](https://developer.mozilla.org/en-US/docs/Web/API/ReadableStream) æˆ– Node.js [Readable](https://nodejs.org/api/stream.html#readable-streams)ã€‚

### `ArrayBuffer`ã€`Uint8Array` æˆ– `Buffer`

å‘é€äºŒè¿›åˆ¶çš„ [ArrayBuffer](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer)ã€[Uint8Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array) æˆ– Node.js çš„ [Buffer](https://nodejs.org/api/buffer.html#buffer)ã€‚

`content-length` å¤´éƒ¨ä¼šè‡ªåŠ¨è®¾ç½®ã€‚

### `Error`

è¿”å›žä¸€ä¸ª [Error](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error) å®žä¾‹å°†å‘é€è¯¥é”™è¯¯ã€‚

å»ºè®® `throw` é”™è¯¯è€Œéžè¿”å›žï¼Œå¹¶ä¸”ä½¿ç”¨ `createError` å·¥å…·ã€‚

### `BigInt`

è¯¥å€¼ä¼šä½œä¸ºå­—ç¬¦ä¸²åŒ–åŽçš„ BigInt æ•°å­—å‘é€ã€‚

> [!NOTE]
> è¿”å›ž JSON å¯¹è±¡æ—¶ä¸æ”¯æŒ BigInt åºåˆ—åŒ–ã€‚ä½ éœ€è¦å®žçŽ° `toJSON`ã€‚è¯¦æƒ…è¯·è§ [MDN æ–‡æ¡£](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify)ã€‚

### `Blob`

ä»¥æµçš„å½¢å¼å‘é€æ ‡å‡† Web [Blob](https://developer.mozilla.org/en-US/docs/Web/API/Blob)ã€‚

`Content-Type` å’Œ `Content-Length` å¤´éƒ¨ä¼šè‡ªåŠ¨è®¾ç½®ã€‚

### `Symbol` æˆ– `Function`

### `File`

å°† Web æ ‡å‡† [File](https://developer.mozilla.org/en-US/docs/Web/API/File) ä½œä¸ºæµå‘é€ã€‚

`Content-type`ã€`Content-Length` å’Œ `Content-Disposition` å¤´å°†è‡ªåŠ¨è®¾ç½®ã€‚

è¿”å›ž Symbol æˆ– Function çš„è¡Œä¸ºæœªç¡®å®šã€‚å½“å‰ç‰ˆæœ¬ä¼šå‘é€æœªçŸ¥çš„ Symbol å’Œ Function çš„å­—ç¬¦ä¸²åŒ–è¡¨ç¤ºï¼Œä½†æœªæ¥å¯èƒ½æ”¹ä¸ºæŠ›å‡ºé”™è¯¯æˆ–ä»Žä¸è¿”å›žã€‚

h3 å†…éƒ¨ä½¿ç”¨ä¸€äº›å·²çŸ¥ Symbolï¼ˆæœªæ¥å¯èƒ½å˜æ›´ï¼‰ï¼š

- `Symbol.for("h3.notFound")`ï¼šè¡¨ç¤ºæœªæ‰¾åˆ°è·¯ç”±ä»¥æŠ›å‡º 404 é”™è¯¯ã€‚
- `Symbol.for("h3.handled")`ï¼šè¡¨ç¤ºè¯·æ±‚å·²è¢«å¤„ç†ï¼Œh3 ä¸åº”ç»§ç»­ï¼ˆä»… Node.jsï¼‰ã€‚

## é”™è¯¯å¤„ç†

ä½ å¯ä»¥ä½¿ç”¨ `createError` å·¥å…·è½»æ¾æŽ§åˆ¶è¿”å›žçš„é”™è¯¯ã€‚

```js
import { createError } from "h3";

app.get("/error", (event) => {
  throw createError({
    status: 400,
    statusMessage: "Bad Request",
    message: "Invalid user input",
    data: { field: "email" },
  });
});
```

è¿™ä¼šä»¥ `400 - Bad Request` çŠ¶æ€ç ç»“æŸè¯·æ±‚ï¼Œå¹¶è¿”å›žä»¥ä¸‹ JSON å“åº”ï¼š

```json
{
  "statusCode": 400,
  "statusMessage": "Bad Request",
  "stack": [],
  "data": {
    "field": "email"
  }
}
```

### å­—ç¬¦ä¸² vs å¯¹è±¡é”™è¯¯

ä½¿ç”¨ `createError` åˆ›å»ºé”™è¯¯æ—¶ï¼Œä½ ä¹Ÿå¯ä»¥ä¼ é€’ä¸€ä¸ªå­—ç¬¦ä¸²è€Œéžå¯¹è±¡ï¼Œè¿™å°†è®¾ç½®é”™è¯¯çš„ `message` å±žæ€§ï¼Œ`statusCode` é»˜è®¤æ˜¯ `500`ã€‚

```js
import { createError } from "h3";

app.get("/error", (event) => {
  throw createError("An error occurred");
});
```

> [!TIP]
> é€šå¸¸ `message` åŒ…å«é”™è¯¯çš„ç®€çŸ­ã€äººç±»å¯è¯»çš„æè¿°ï¼Œè€Œ `statusMessage` ç‰¹æŒ‡ HTTP å“åº”ä¸­ä¸ŽçŠ¶æ€ç ç›¸å…³çš„çŠ¶æ€æ–‡æœ¬ã€‚  
> åœ¨å®¢æˆ·ç«¯-æœåŠ¡å™¨çŽ¯å¢ƒä¸­ï¼ŒæŽ¨èä½¿ç”¨ç®€çŸ­çš„ `statusMessage`ï¼Œå› ä¸ºå®ƒèƒ½è¢«å®¢æˆ·ç«¯è®¿é—®ã€‚å¦åˆ™ï¼ŒæœåŠ¡å™¨ç«¯ä¼ å…¥ `createError` çš„ `message` ä¸ä¼šä¼ æ’­ç»™å®¢æˆ·ç«¯ï¼ˆå¯ä»¥ä½¿ç”¨ `data`ï¼‰ã€‚æœ€å¥½é¿å…å°†åŠ¨æ€ç”¨æˆ·è¾“å…¥ç›´æŽ¥æ”¾å…¥ `message` ä»¥é¿å…æ½œåœ¨å®‰å…¨é£Žé™©ã€‚

### å†…éƒ¨é”™è¯¯

å¦‚æžœè°ƒç”¨äº‹ä»¶å¤„ç†å™¨æ—¶æŠ›å‡ºäº†ä¸€ä¸ª `new Error()`ï¼ˆæœªä½¿ç”¨ `createError`ï¼‰ï¼Œh3 ä¼šè‡ªåŠ¨æ•èŽ·å¹¶ä½œä¸º [`500 - Internal Server Error`](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/500) çŠ¶æ€å“åº”ï¼Œè§†ä¸ºæœªå¤„ç†é”™è¯¯ã€‚

```js
app.get("/error", (event) => {
  // ä¸æŽ¨èè¿™æ ·ç”¨ï¼Œè¯·ä½¿ç”¨ createError()ï¼
  throw new Error("Something went wrong");
});
```

## å»¶è¿Ÿå¤„ç†å™¨

ä½ å¯ä»¥ä½¿ç”¨ `defineLazyEventHandler` å®šä¹‰å»¶è¿Ÿäº‹ä»¶å¤„ç†å™¨ã€‚å®ƒå…è®¸ä½ å®šä¹‰ä¸€äº›åªä¼šåœ¨é¦–æ¬¡æŽ¥æ”¶åˆ°åŒ¹é…è·¯ç”±çš„è¯·æ±‚æ—¶æ‰§è¡Œä¸€æ¬¡çš„é€»è¾‘ã€‚

å»¶è¿Ÿäº‹ä»¶å¤„ç†å™¨å¿…é¡»è¿”å›žä¸€ä¸ªäº‹ä»¶å¤„ç†å™¨ï¼š

```js
import { defineLazyEventHandler } from "h3";

app.get(
  "/lazy",
  defineLazyEventHandler(() => {
    console.log("This will be executed only once");
    // è¿™é‡Œçš„ä»£ç åªä¼šæ‰§è¡Œä¸€æ¬¡
    return (event) => {
      // è¿™é‡Œçš„ä»£ç ä¼šåœ¨æ¯æ¬¡è¯·æ±‚æ—¶æ‰§è¡Œ
      return "Response";
    };
  }),
);
```

è¿™é€‚åˆå®šä¹‰ä¸€äº›ä¸€æ¬¡æ€§é€»è¾‘ï¼Œå¦‚é…ç½®ã€ç±»åˆå§‹åŒ–ã€å¤æ‚è®¡ç®—ç­‰ã€‚

## ä¸­é—´ä»¶

ä½ å¯ä»¥ä½¿ç”¨ [`app.use`](/guide/app#appusemiddleware-opts-method-string-route-string) æ³¨å†Œå…¨å±€ä¸­é—´ä»¶æ¥æ‹¦æˆªè¯·æ±‚ã€‚å®ƒä»¬å¯ç”¨äºŽä¸ºä½ çš„åº”ç”¨æ·»åŠ å‰¯ä½œç”¨ï¼Œå¦‚æ—¥å¿—è®°å½•ã€ç¼“å­˜ç­‰ï¼Œæˆ–ä¿®æ”¹è¯·æ±‚æˆ–å“åº”ã€‚

å¦‚æžœä½ ä»Žä¸­é—´ä»¶ä¸­è¿”å›žä¸€ä¸ªå€¼ï¼Œè¯¥å€¼å°†ä½œä¸ºæ™®é€šäº‹ä»¶å¤„ç†å™¨çš„ç»“æžœè¢«å‘é€ä¸ºå“åº”ã€‚

**ç¤ºä¾‹ï¼š** ç®€å•çš„è¯·æ±‚æ—¥å¿—ä¸­é—´ä»¶ï¼š

```js
app.use((event) => {
  console.log(`[${event.req.method}] ${event.req.url}`);
  // [ä¸è¿”å›žå€¼]
});
```

**ç¤ºä¾‹ï¼š** æ‹¦æˆªå“åº”ï¼š

```js
app.use(async (event, next) => {
  const rawResponse = await next();
  // [æ‹¦æˆªå“åº”]
  return rawResponse;
});
```

**ç¤ºä¾‹ï¼š** ä½¿ç”¨è·¯ç”±å’Œæ–¹æ³•è¿‡æ»¤å™¨æ·»åŠ ä¸­é—´ä»¶ï¼š

```js
app.use(
  (event, next) => {
    console.log("[alert] POST è¯·æ±‚åœ¨ /blog è·¯å¾„ä¸Šï¼");
  },
  {
    method: "POST",
    route: "/blog/**",
    // match: (event) => event.req.method === "POST", // ç­‰åŒäºŽ method: "POST"
  },
);
```

ä½ å¯ä»¥å®šä¹‰ä»»æ„æ•°é‡çš„ä¸­é—´ä»¶ã€‚å®ƒä»¬ä¼šæŒ‰æ³¨å†Œé¡ºåºè°ƒç”¨ã€‚

:read-more{to="/guide/routing#adding-middleware"}

## è½¬æ¢ä¸º H3 å¤„ç†å™¨

æŸäº›æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½æƒ³æŠŠä¸º Node.js æˆ–å…¶ä»–æ¡†æž¶å†™çš„äº‹ä»¶å¤„ç†å™¨æˆ–å·¥å…·è½¬æ¢æˆ h3 å¯ç”¨ã€‚

h3 å†…ç½®äº†ç›¸å…³å·¥å…·ï¼

### ä»Ž Web å¤„ç†å™¨è½¬æ¢

ä½¿ç”¨ [Request](https://developer.mozilla.org/en-US/docs/Web/API/Request) => [Response](https://developer.mozilla.org/en-US/docs/Web/API/Response) è¯­æ³•çš„è¯·æ±‚å¤„ç†å™¨å¯ä»¥åŽŸç”Ÿè½¬æ¢ä¸º h3 äº‹ä»¶å¤„ç†å™¨ï¼š

```js
import { H3, fromWebHandler } from "h3";

export const app = new H3();

const webHandler = (request) => new Response("ðŸ‘‹ Hello!");

// ä½¿ç”¨ fromWebHandler å·¥å…·
app.get("/web", fromWebHandler(webHandler));

// ä½¿ç”¨ç®€å•åŒ…è£…å™¨
app.get("/web", event => webHandler(event.req));
```

### ä»Ž Node.js å¤„ç†å™¨è½¬æ¢

å¦‚æžœä½ æœ‰ä¸€ä¸ªç”¨ `(req, res) => {}` è¯­æ³•å†™çš„ Node.js æ—§è¯·æ±‚å¤„ç†å™¨ï¼Œå¯ä»¥ç”¨ `fromNodeHandler` è½¬æ¢æˆ h3 äº‹ä»¶å¤„ç†å™¨ã€‚

> [!NOTE]
> Node.js å¤„ç†å™¨åªèƒ½åœ¨ Node.js æœåŠ¡å™¨è¿è¡Œæ—¶æ‰§è¡Œï¼

```js
import { H3, fromNodeHandler } from "h3";

export const app = new H3();

const nodeHandler = (req, res) => {
  res.end("Node handlers work!");
};

app.get("/web", fromNodeHandler(nodeHandler));
```