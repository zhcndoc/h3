---
icon: cib:socket-io
---

# WebSockets

<<<<<<< HEAD
> H3 å†…ç½®æ”¯æŒè·¨å¹³å°çš„ WebSocket å’Œ SSEã€‚

H3 åŸç”Ÿæ”¯æŒä¸è¿è¡Œæ—¶æ— å…³çš„ [WebSocket](https://developer.mozilla.org/en-US/docs/Web/API/WebSocket) APIï¼Œä½¿ç”¨ [CrossWS](https://crossws.unjs.io/) ã€‚

::tip
æ‚¨å¯ä»¥åœ¨ç°æœ‰çš„ [äº‹ä»¶å¤„ç†ç¨‹åº](/guide/event-handler) ä¸­å®šä¹‰ WebSocket å¤„ç†ç¨‹åºï¼Œä»¥å®šä¹‰å¤šä¸ª WebSocket å¤„ç†ç¨‹åºï¼Œå¹¶ä¸æ‚¨çš„ç›¸åŒè·¯ç”±å®šä¹‰åŠ¨æ€åŒ¹é…ï¼
::

:read-more{title="MDN ä¸­çš„ WebSocket" to="https://developer.mozilla.org/en-US/docs/Web/API/WebSocket"}
=======
> H3 has built-in support for cross platform WebSocket and Server-Sent Events.

H3 has built-in, runtime agnostic [WebSocket](https://developer.mozilla.org/en-US/docs/Web/API/WebSocket) support using [ğŸ”Œ CrossWS](https://crossws.unjs.io/).
>>>>>>> origin/upstream

:read-more{title="CrossWS" to="https://crossws.unjs.io/"}

> [!IMPORTANT]
<<<<<<< HEAD
> WebSockets çš„æ”¯æŒç›®å‰å¤„äºå®éªŒé˜¶æ®µï¼Œå¯åœ¨ [nightly channel](/guide/nightly) ä¸­ä½¿ç”¨ã€‚
=======
> Built-in support of WebSockets in h3 v2 is WIP.
>>>>>>> origin/upstream

## ç”¨æ³•

<<<<<<< HEAD
### ç¤ºä¾‹

> [!TIP]
> æ‚¨å¯ä»¥ä½¿ç”¨ `npx listhen --ws -w websocket.ts` æ¥è¿è¡Œæ­¤ç¤ºä¾‹ã€‚

<!-- automd:file code src="../../examples/websocket.ts" -->

```ts [websocket.ts]
import { H3, defineWebSocketHandler } from "h3";
=======
<!-- automd:file code lang="js" src="../../examples/websocket.mjs" -->

```js [websocket.mjs]
import { H3, serve, proxy, defineWebSocketHandler } from "h3";
>>>>>>> origin/upstream

export const app = new H3();

const websocketDemoURL =
  "https://raw.githubusercontent.com/unjs/crossws/main/examples/h3/public/index.html";

app.get("/", (event) =>
  proxy(event, websocketDemoURL, { headers: { "Content-Type": "text/html" } }),
);

app.use(
  "/_ws",
  defineWebSocketHandler({
    open(peer) {
      console.log("[ws] open", peer);
    },

    message(peer, message) {
      console.log("[ws] message", peer, message);
      if (message.text().includes("ping")) {
        peer.send("pong");
      }
    },

    close(peer, event) {
      console.log("[ws] close", peer, event);
    },

    error(peer, error) {
      console.log("[ws] error", peer, error);
    },
  }),
);

<<<<<<< HEAD
=======
await serve(app)
  .ready()
  .then((s) => console.log(`Server running at ${s.url}`));
>>>>>>> origin/upstream
```

<!-- /automd -->

## æœåŠ¡å™¨æ¨é€äº‹ä»¶ (SSE)

ä½œä¸º WebSockets çš„æ›¿ä»£æ–¹æ¡ˆï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ [æœåŠ¡å™¨æ¨é€äº‹ä»¶](https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events)ã€‚

H3 å†…ç½® API å¯ä½¿ç”¨ `createEventStream(event)` å·¥å…·åˆ›å»ºæœåŠ¡å™¨æ¨é€äº‹ä»¶ã€‚

<<<<<<< HEAD
> [!IMPORTANT]
> SSE çš„æ”¯æŒç›®å‰å¤„äºå®éªŒé˜¶æ®µï¼Œå¯åœ¨ [nightly channel](/guide/nightly) ä¸­ä½¿ç”¨ã€‚

### ç¤ºä¾‹
=======
### Example
>>>>>>> origin/upstream

<!-- automd:file code lang="js" src="../../examples/server-sent-events.mjs" -->

```js [server-sent-events.mjs]
import { H3, serve, createEventStream } from "h3";

export const app = new H3();

app.get("/", (event) => {
  const eventStream = createEventStream(event);

  // Send a message every second
  const interval = setInterval(async () => {
    await eventStream.push("Hello world");
  }, 1000);

  // cleanup the interval when the connection is terminated or the writer is closed
  eventStream.onClosed(() => {
    console.log("Connection closed");
    clearInterval(interval);
  });

  return eventStream.send();
});

<<<<<<< HEAD
=======
await serve(app)
  .ready()
  .then((s) => console.log(`Server running at ${s.url}`));
>>>>>>> origin/upstream
```

<!-- /automd -->
