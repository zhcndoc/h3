---
icon: ic:baseline-bolt
---

<<<<<<< HEAD
# åº”ç”¨å®ä¾‹

> åº”ç”¨å®ä¾‹æ˜¯ h3 æœåŠ¡å™¨çš„æ ¸å¿ƒã€‚

h3 æœåŠ¡å™¨çš„æ ¸å¿ƒæ˜¯ä¸€ä¸ª `app` å®ä¾‹ã€‚å®ƒæ˜¯å¤„ç†ä¼ å…¥è¯·æ±‚çš„æœåŠ¡å™¨æ ¸å¿ƒã€‚æ‚¨å¯ä»¥ä½¿ç”¨åº”ç”¨å®ä¾‹æ³¨å†Œäº‹ä»¶å¤„ç†ç¨‹åºã€‚

## åˆå§‹åŒ–ä¸€ä¸ªåº”ç”¨

æ‚¨å¯ä»¥ä½¿ç”¨ [`createApp`](/guide/app) å·¥å…·åˆ›å»ºä¸€ä¸ªæ–°çš„ h3 åº”ç”¨å®ä¾‹ï¼š

```js [app.mjs]
import { createApp } from "h3";

const app = createApp();
```

## è®¾ç½®å…¨å±€é€‰é¡¹
=======
# H3 App Instance

> H3 app instance is the core of a h3 server that handles incoming requests.

You can create a new h3 app instance using `new H3()`:

```js [server.mjs]
import { H3 } from "h3";

const app = new H3(/* optional config */);
```

## H3 App Options
>>>>>>> origin/upstream

åœ¨åˆå§‹åŒ–åº”ç”¨æ—¶ï¼Œæ‚¨å¯ä»¥ä¼ é€’å…¨å±€åº”ç”¨é…ç½®ã€‚

**ç¤ºä¾‹ï¼š** åˆ›å»ºä¸€ä¸ªå¯ç”¨è¯¦ç»†æ—¥å¿—è®°å½•çš„åº”ç”¨ã€‚

```js
const app = new H3({ debug: true });
```

<<<<<<< HEAD
## è®¾ç½®å…¨å±€é’©å­
=======
### Global Hooks
>>>>>>> origin/upstream

åœ¨åˆå§‹åŒ– h3 åº”ç”¨æ—¶ï¼Œæ‚¨å¯ä»¥æ³¨å†Œå…¨å±€é’©å­ï¼š

- `onError`
- `onRequest`
- `onBeforeResponse`

è¿™äº›é’©å­ä¼šåœ¨æ¯ä¸ªè¯·æ±‚ä¸­è¢«è°ƒç”¨ï¼Œå¯ä»¥ç”¨æ¥ä¸ºæ‚¨çš„åº”ç”¨æ·»åŠ å…¨å±€é€»è¾‘ï¼Œä¾‹å¦‚æ—¥å¿—è®°å½•ã€é”™è¯¯å¤„ç†ç­‰ã€‚

```js
const app = new H3({
  onError: (error) => {
    console.error(error);
  },
  onRequest: (event) => {
    console.log("è¯·æ±‚ï¼š", event.path);
  },
});
```

<<<<<<< HEAD
## æ³¨å†Œäº‹ä»¶å¤„ç†ç¨‹åº

æ‚¨å¯ä»¥ä½¿ç”¨ `app.use` å°† [äº‹ä»¶å¤„ç†ç¨‹åº](/guide/event-handler) æ³¨å†Œåˆ°åº”ç”¨å®ä¾‹ï¼š

```js
app.use("/hello", () => "ä½ å¥½ï¼Œä¸–ç•Œï¼");
```

è¿™å°†æŠŠäº‹ä»¶å¤„ç†ç¨‹åºæ³¨å†Œåˆ°åº”ç”¨å®ä¾‹ï¼Œå¹¶å°†åœ¨æ¯ä¸ªä»¥ `/hello` å¼€å¤´çš„è¯·æ±‚ä¸­è¢«è°ƒç”¨ã€‚è¿™æ„å‘³ç€äº‹ä»¶å¤„ç†ç¨‹åºå°†è¢«è°ƒç”¨ `/hello`ã€`/hello/world`ã€`/hello/123` ç­‰ã€‚

æ‚¨å¯ä»¥ä¸ºåŒä¸€è·¯ç”±å®šä¹‰å¤šä¸ªäº‹ä»¶å¤„ç†ç¨‹åºã€‚h3 å°†å°è¯•æŒ‰æ³¨å†Œé¡ºåºé€ä¸ªè°ƒç”¨å®ƒä»¬ï¼Œç›´åˆ°å…¶ä¸­ä¸€ä¸ªè¿”å›å“åº”ã€‚è¿™ç§°ä¸º `å †æ ˆè¿è¡Œå™¨`ã€‚

```js
app.use("/", () => "ç¬¬ä¸€ä¸ª");
app.use("/", () => "ç¬¬äºŒä¸ª");
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œç¬¬ä¸€ä¸ªäº‹ä»¶å¤„ç†ç¨‹åºå°†ä¼šè¢«æ‰€æœ‰ä»¥ `/hello` å¼€å¤´çš„è¯·æ±‚è°ƒç”¨ï¼Œè€Œç¬¬äºŒä¸ªåˆ™ä¸ä¼šè¢«è°ƒç”¨ã€‚

ç„¶è€Œï¼Œå¦‚æœæ‚¨ä¸ä»ç¬¬ä¸€ä¸ªäº‹ä»¶å¤„ç†ç¨‹åºè¿”å›å“åº”ï¼Œç¬¬äºŒä¸ªå°†ä¼šè¢«è°ƒç”¨ã€‚è¿™å¯¹äºå®ç° _ä¸­é—´ä»¶_ æ¨¡å¼éå¸¸æœ‰ç”¨ã€‚

```js
app.use("/", () => {
  console.log("ç¬¬ä¸€ä¸ª");
  // æœªè¿”å›å“åº”
});
app.use("/", () => "ç¬¬äºŒä¸ª");
```

å¦‚æœæ‰€æœ‰å¤„ç†ç¨‹åºéƒ½è¢«è°ƒç”¨ä¸”æ²¡æœ‰è¿”å›å“åº”ï¼Œh3 å°†ä»¥ 404 çŠ¶æ€å“åº”ç»“æŸè¯·æ±‚ã€‚

> [!NOTE]
> ä½¿ç”¨ç©ºçš„ `return` æˆ– `return undefined` ä¼šè¿”å› [`404 Not Found`](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404) çŠ¶æ€å“åº”ã€‚
> åŒæ ·ä½¿ç”¨ `return null` ä¼šè¿”å› [`204 No Content`](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/204) çŠ¶æ€å“åº”ã€‚

> [!TIP]
> ä½¿ç”¨ `return {}` æˆ– `return ""` æˆ– `return true` æ¥æ˜ç¡®è¿”å›å“åº”ã€‚

## äº‹ä»¶å¤„ç†ç¨‹åºé€‰é¡¹

`use` æ–¹æ³•æ¥å—ä¸€ä¸ªå¯é€‰çš„ `options` å¯¹è±¡ä½œä¸ºç¬¬ä¸‰ä¸ªå‚æ•°ï¼š

```js
app.use("/hello", () => "ä½ å¥½ï¼Œä¸–ç•Œï¼", {
  // é€‰é¡¹
});
```
=======
## H3 App Methods

### `app.fetch(request, init?, context?)`

A [fetch](https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)-like API allowing to fetch app routes.

Input can be a URL, relative path or standard [Request](https://developer.mozilla.org/en-US/docs/Web/API/Request) object.

Returned value is a standard [Response](https://developer.mozilla.org/en-US/docs/Web/API/Response) or a promise resolving to a Response.

**Example:**

```ts
const response = await app.fetch("/");

console.log(response, await response.text());
```

### `app.handler(event)`

An h3 compatible event handler useful to compose multiple h3 app instances.

### `app.resolve(method, path)`

Resolve a route handler by method and path useful for custom purposes.

### `app.on(method, route, handler)`

Register route handler for specific HTTP method.

### `app.[method](route, handler)`

Register route handler for specific HTTP method (shortcut for `app.on(method, ...)`).

### `app.all(route, handler)`

Register route handler for all HTTP methods.

### `app.use(handler, opts?)`

Register a global middleware handler.
>>>>>>> origin/upstream

### `app.use(route, handler, opts?)`

<<<<<<< HEAD
æ‚¨å¯ä»¥å®šä¹‰ä¸€ä¸ªè‡ªå®šä¹‰åŒ¹é…å™¨å‡½æ•°ï¼Œä»¥ä¾¿ä¸ºè¯·æ±‚åŒ¹é…æä¾›æ›´é«˜çº§çš„é€»è¾‘ï¼Œä½†æ¯”è·¯ç”±æ›´ç®€å•ã€‚

ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥åªåŒ¹é…å¥‡æ•° URLï¼Œ`/1`ã€`/3`ã€`/5` ç­‰ï¼š

```js
app.use("/", () => "ä»…å¥‡æ•° URL", {
  match: (url) => {
    return url.substr(1) % 2;
  },
});
```

> [!WARNING]
> ä¸è¦å°†è‡ªå®šä¹‰åŒ¹é…å™¨ç”¨ä½œè·¯ç”±å™¨ã€‚å®ƒä¸ä¸ºè¯¥ç›®çš„è€Œè®¾è®¡ã€‚è¯·ä½¿ç”¨ [è·¯ç”±å™¨](/guide/router)ã€‚
=======
Register a routed global middleware handler.

## H3 App Properties

### `app.config`

Global h3 instance config.
>>>>>>> origin/upstream

### `app.websocket`

<<<<<<< HEAD
æ‚¨å¯ä»¥æä¾›ä¸€ä¸ªå¼‚æ­¥å‡½æ•°ï¼Œh3 ä¼šåœ¨é¦–æ¬¡æ¥æ”¶åˆ°åŒ¹é…è¯¥è·¯ç”±çš„è¯·æ±‚æ—¶åŠ è½½å®ƒã€‚å®ƒå¯¹äºåŠ¨æ€å¯¼å…¥éå¸¸æœ‰ç”¨ï¼Œä»¥å‡å°‘å¯åŠ¨æ—¶é—´ã€‚

```js
app.use("/big", () => import("./big-handler"), { lazy: true });
```

è¿™å‡å°‘äº†å¯åŠ¨æ—¶é—´ï¼Œå› ä¸ºåœ¨å¯åŠ¨æœåŠ¡å™¨æ—¶è¿è¡Œæ—¶éœ€è¦åŠ è½½å’Œè§£æçš„ä»£ç æ›´å°‘ã€‚

## å†…éƒ¨å®ç°

> [!IMPORTANT]
> è¿™äº›è¯¦æƒ…ä¸»è¦æ˜¯ä¾›å‚è€ƒã€‚**ç»ä¸è¦** åœ¨ç”Ÿäº§åº”ç”¨ä¸­ç›´æ¥ä½¿ç”¨å†…éƒ¨å®ç°ï¼

h3 åº”ç”¨å®ä¾‹æœ‰ä¸€äº›é¢å¤–çš„å±æ€§ã€‚ç„¶è€Œï¼Œé€šå¸¸ä¸å»ºè®®ç›´æ¥è®¿é—®å®ƒä»¬ï¼Œé™¤éæ‚¨çŸ¥é“è‡ªå·±åœ¨åšä»€ä¹ˆï¼

- `app.stack`: å½“å‰æ³¨å†Œçš„äº‹ä»¶å¤„ç†ç¨‹åºçš„æœ‰åºæ•°ç»„ã€‚
  - æ¯ä¸ªé¡¹ç›®éƒ½æœ‰ `route` å’Œ `handler` å±æ€§ã€‚
- `app.options`: åœ¨åˆå§‹åŒ–åº”ç”¨æ—¶æä¾›çš„å…¨å±€é€‰é¡¹å¯¹è±¡ã€‚
- `app.handler`: ç›´æ¥çš„å †æ ˆå¤„ç†å‡½æ•°ï¼ˆ**ä¸å®‰å…¨ï¼Œä¸èƒ½ç›´æ¥è°ƒç”¨**ï¼‰ã€‚
=======
Websocket hooks compatible with [ğŸ”Œ crossws](https://crossws.unjs.io/).
>>>>>>> origin/upstream
