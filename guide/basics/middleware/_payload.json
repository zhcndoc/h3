[{"data":1,"prerenderedAt":954},["ShallowReactive",2],{"navigation":3,"-guide-basics-middleware":185,"-guide-basics-middleware-surround":949},[4,91,133,161,168],{"title":5,"path":6,"stem":7,"children":8,"icon":90},"Guide","/guide","1.guide/0.index",[9,12,53,69],{"title":10,"path":6,"stem":7,"icon":11},"入门指南","pixel:play",{"title":5,"icon":13,"path":14,"stem":15,"children":16,"page":52},"ph:book-open-duotone","/guide/basics","1.guide/1.basics",[17,22,27,32,37,42,47],{"title":18,"path":19,"stem":20,"icon":21},"请求生命周期","/guide/basics/lifecycle","1.guide/1.basics/1.lifecycle","icon-park-outline:handle-round",{"title":23,"path":24,"stem":25,"icon":26},"路由","/guide/basics/routing","1.guide/1.basics/2.routing","solar:routing-bold",{"title":28,"path":29,"stem":30,"icon":31},"中间件","/guide/basics/middleware","1.guide/1.basics/3.middleware","mdi:middleware-outline",{"title":33,"path":34,"stem":35,"icon":36},"事件处理器","/guide/basics/handler","1.guide/1.basics/4.handler","mdi:function",{"title":38,"path":39,"stem":40,"icon":41},"发送响应","/guide/basics/response","1.guide/1.basics/5.response","tabler:json",{"title":43,"path":44,"stem":45,"icon":46},"错误处理","/guide/basics/error","1.guide/1.basics/6.error","tabler:error-404",{"title":48,"path":49,"stem":50,"icon":51},"嵌套应用","/guide/basics/nested-apps","1.guide/1.basics/7.nested-apps","material-symbols-light:layers-outline",false,{"title":54,"icon":55,"path":56,"stem":57,"children":58,"page":52},"API","material-symbols-light:api-rounded","/guide/api","1.guide/900.api",[59,64],{"title":60,"path":61,"stem":62,"icon":63},"H3","/guide/api/h3","1.guide/900.api/1.h3","material-symbols:bolt-rounded",{"title":65,"path":66,"stem":67,"icon":68},"H3Event","/guide/api/h3event","1.guide/900.api/2.h3event","material-symbols:data-object-rounded",{"title":70,"icon":71,"path":72,"stem":73,"children":74,"page":52},"Advanced","hugeicons:more-01","/guide/advanced","1.guide/901.advanced",[75,80,85],{"title":76,"path":77,"stem":78,"icon":79},"Plugins","/guide/advanced/plugins","1.guide/901.advanced/1.plugins","clarity:plugin-line",{"title":81,"path":82,"stem":83,"icon":84},"WebSockets","/guide/advanced/websocket","1.guide/901.advanced/2.websocket","hugeicons:live-streaming-02",{"title":86,"path":87,"stem":88,"icon":89},"每夜构建","/guide/advanced/nightly","1.guide/901.advanced/9.nightly","game-icons:barn-owl","i-ph:book-open-duotone",{"title":92,"path":93,"stem":94,"children":95,"icon":97},"H3 工具集","/utils","2.utils/0.index",[96,98,103,108,113,118,123,128],{"title":92,"path":93,"stem":94,"icon":97},"ph:function-bold",{"title":99,"path":100,"stem":101,"icon":102},"请求","/utils/request","2.utils/1.request","material-symbols-light:input",{"title":104,"path":105,"stem":106,"icon":107},"响应","/utils/response","2.utils/2.response","material-symbols-light:output",{"title":109,"path":110,"stem":111,"icon":112},"Cookie","/utils/cookie","2.utils/3.cookie","material-symbols:cookie-outline",{"title":114,"path":115,"stem":116,"icon":117},"安全","/utils/security","2.utils/4.security","wpf:key-security",{"title":119,"path":120,"stem":121,"icon":122},"代理","/utils/proxy","2.utils/5.proxy","arcticons:super-proxy",{"title":124,"path":125,"stem":126,"icon":127},"更多工具","/utils/more","2.utils/9.more","mingcute:plus-line",{"title":129,"path":130,"stem":131,"icon":132},"社区","/utils/community","2.utils/99.community","lets-icons:external",{"title":134,"path":135,"stem":136,"children":137,"icon":139},"示例","/examples","4.examples/0.index",[138,140,145,149,153,157],{"title":134,"path":135,"stem":136,"icon":139},"ph:code",{"title":141,"path":142,"stem":143,"icon":144},"Cookies","/examples/handle-cookie","4.examples/handle-cookie","ph:arrow-right",{"title":146,"path":147,"stem":148,"icon":144},"会话","/examples/handle-session","4.examples/handle-session",{"title":150,"path":151,"stem":152,"icon":144},"静态资源","/examples/serve-static-assets","4.examples/serve-static-assets",{"title":154,"path":155,"stem":156,"icon":144},"流式响应","/examples/stream-response","4.examples/stream-response",{"title":158,"path":159,"stem":160,"icon":144},"验证数据","/examples/validate-data","4.examples/validate-data",{"title":162,"path":163,"stem":164,"children":165,"icon":167},"从 v1 到 v2 的迁移指南","/migration","5.migration/0.index",[166],{"title":162,"path":163,"stem":164,"icon":167},"icons8:up-round",{"title":169,"path":170,"stem":171,"children":172},"Blog","/blog","99.blog",[173,177,181],{"title":174,"path":170,"stem":175,"icon":176},"博客","99.blog/index","i-lucide-file-text",{"title":178,"path":179,"stem":180,"icon":176},"H3 1.8 - 迈向 Web 的边缘","/blog/v1.8","99.blog/1.v1.8",{"title":182,"path":183,"stem":184,"icon":176},"H3 v2 测试版","/blog/v2-beta","99.blog/2.v2-beta",{"id":186,"title":28,"body":187,"description":943,"extension":944,"meta":945,"navigation":946,"path":29,"seo":947,"stem":30,"__hash__":948},"content/1.guide/1.basics/3.middleware.md",{"type":188,"value":189,"toc":941,"icon":31},"minimark",[190,197,200,204,220,227,284,289,388,394,463,470,532,545,548,642,657,937],[191,192,193],"important",{},[194,195,196],"p",{},"\n我们建议尽可能使用组合式工具。全局中间件可能会让应用逻辑变得更复杂，降低其可预测性和理解难度。",[194,198,199],{},"全局中间件在每个请求路由处理之前运行，作为包装器来拦截请求、响应和错误。",[201,202],"read-more",{"title":18,"to":203},"/guide/basics/lifecycle#\\_3-dispatch-request",[194,205,206,207,215,216,219],{},"你可以使用 ",[208,209,211],"a",{"href":210},"/guide/api/h3#h3use",[212,213,214],"code",{},"H3.use"," 向 ",[208,217,218],{"href":61},"app 实例"," 注册全局中间件。",[194,221,222,226],{},[223,224,225],"strong",{},"示例："," 注册一个记录每个请求的全局中间件。",[228,229,234],"pre",{"className":230,"code":231,"language":232,"meta":233,"style":233},"language-js shiki shiki-themes github-light github-dark github-dark","app.use((event) => {\n  console.log(event);\n});\n","js","",[212,235,236,266,278],{"__ignoreMap":233},[237,238,241,245,249,252,256,259,263],"span",{"class":239,"line":240},"line",1,[237,242,244],{"class":243},"slsVL","app.",[237,246,248],{"class":247},"shcOC","use",[237,250,251],{"class":243},"((",[237,253,255],{"class":254},"sQHwn","event",[237,257,258],{"class":243},") ",[237,260,262],{"class":261},"so5gQ","=>",[237,264,265],{"class":243}," {\n",[237,267,269,272,275],{"class":239,"line":268},2,[237,270,271],{"class":243},"  console.",[237,273,274],{"class":247},"log",[237,276,277],{"class":243},"(event);\n",[237,279,281],{"class":239,"line":280},3,[237,282,283],{"class":243},"});\n",[194,285,286,288],{},[223,287,225],{}," 注册一个匹配特定请求的全局中间件。",[228,290,292],{"className":230,"code":291,"language":232,"meta":233,"style":233},"app.use(\n  \"/blog/**\",\n  (event, next) => {\n    console.log(\"[alert] POST 请求访问 /blog 路径！\");\n  },\n  {\n    method: \"POST\",\n    // match: (event) => event.req.method === \"POST\",\n  },\n);\n",[212,293,294,303,312,331,348,354,360,371,378,383],{"__ignoreMap":233},[237,295,296,298,300],{"class":239,"line":240},[237,297,244],{"class":243},[237,299,248],{"class":247},[237,301,302],{"class":243},"(\n",[237,304,305,309],{"class":239,"line":268},[237,306,308],{"class":307},"sfrk1","  \"/blog/**\"",[237,310,311],{"class":243},",\n",[237,313,314,317,319,322,325,327,329],{"class":239,"line":280},[237,315,316],{"class":243},"  (",[237,318,255],{"class":254},[237,320,321],{"class":243},", ",[237,323,324],{"class":254},"next",[237,326,258],{"class":243},[237,328,262],{"class":261},[237,330,265],{"class":243},[237,332,334,337,339,342,345],{"class":239,"line":333},4,[237,335,336],{"class":243},"    console.",[237,338,274],{"class":247},[237,340,341],{"class":243},"(",[237,343,344],{"class":307},"\"[alert] POST 请求访问 /blog 路径！\"",[237,346,347],{"class":243},");\n",[237,349,351],{"class":239,"line":350},5,[237,352,353],{"class":243},"  },\n",[237,355,357],{"class":239,"line":356},6,[237,358,359],{"class":243},"  {\n",[237,361,363,366,369],{"class":239,"line":362},7,[237,364,365],{"class":243},"    method: ",[237,367,368],{"class":307},"\"POST\"",[237,370,311],{"class":243},[237,372,374],{"class":239,"line":373},8,[237,375,377],{"class":376},"sCsY4","    // match: (event) => event.req.method === \"POST\",\n",[237,379,381],{"class":239,"line":380},9,[237,382,353],{"class":243},[237,384,386],{"class":239,"line":385},10,[237,387,347],{"class":243},[194,389,390,391,393],{},"你可以注册带有 ",[212,392,324],{}," 参数的中间件，以拦截后续中间件和处理器的返回值。",[228,395,397],{"className":230,"code":396,"language":232,"meta":233,"style":233},"app.use(async (event, next) => {\n  const rawBody = await next();\n  // [拦截响应]\n  return rawBody;\n});\n",[212,398,399,425,446,451,459],{"__ignoreMap":233},[237,400,401,403,405,407,410,413,415,417,419,421,423],{"class":239,"line":240},[237,402,244],{"class":243},[237,404,248],{"class":247},[237,406,341],{"class":243},[237,408,409],{"class":261},"async",[237,411,412],{"class":243}," (",[237,414,255],{"class":254},[237,416,321],{"class":243},[237,418,324],{"class":254},[237,420,258],{"class":243},[237,422,262],{"class":261},[237,424,265],{"class":243},[237,426,427,430,434,437,440,443],{"class":239,"line":268},[237,428,429],{"class":261},"  const",[237,431,433],{"class":432},"suiK_"," rawBody",[237,435,436],{"class":261}," =",[237,438,439],{"class":261}," await",[237,441,442],{"class":247}," next",[237,444,445],{"class":243},"();\n",[237,447,448],{"class":239,"line":280},[237,449,450],{"class":376},"  // [拦截响应]\n",[237,452,453,456],{"class":239,"line":333},[237,454,455],{"class":261},"  return",[237,457,458],{"class":243}," rawBody;\n",[237,460,461],{"class":239,"line":350},[237,462,283],{"class":243},[194,464,465,466,469],{},"下面示例中，总是响应 ",[212,467,468],{},"Middleware 1","。",[228,471,473],{"className":230,"code":472,"language":232,"meta":233,"style":233},"app\n  .use(() => \"Middleware 1\")\n  .use(() => \"Middleware 2\")\n  .get(\"/\", \"Hello\");\n",[212,474,475,480,498,513],{"__ignoreMap":233},[237,476,477],{"class":239,"line":240},[237,478,479],{"class":243},"app\n",[237,481,482,485,487,490,492,495],{"class":239,"line":268},[237,483,484],{"class":243},"  .",[237,486,248],{"class":247},[237,488,489],{"class":243},"(() ",[237,491,262],{"class":261},[237,493,494],{"class":307}," \"Middleware 1\"",[237,496,497],{"class":243},")\n",[237,499,500,502,504,506,508,511],{"class":239,"line":280},[237,501,484],{"class":243},[237,503,248],{"class":247},[237,505,489],{"class":243},[237,507,262],{"class":261},[237,509,510],{"class":307}," \"Middleware 2\"",[237,512,497],{"class":243},[237,514,515,517,520,522,525,527,530],{"class":239,"line":333},[237,516,484],{"class":243},[237,518,519],{"class":247},"get",[237,521,341],{"class":243},[237,523,524],{"class":307},"\"/\"",[237,526,321],{"class":243},[237,528,529],{"class":307},"\"Hello\"",[237,531,347],{"class":243},[191,533,534],{},[194,535,536,537,540,541,544],{},"\n如果中间件返回除 ",[212,538,539],{},"undefined"," 或 ",[212,542,543],{},"next()"," 结果之外的值，中间件会立即拦截请求处理并发送响应。",[194,546,547],{},"在添加路由时，可以注册只随该路由运行的中间件。",[228,549,551],{"className":230,"code":550,"language":232,"meta":233,"style":233},"import { basicAuth } from \"h3\";\n\napp.get(\n  \"/secret\",\n  (event) => {\n    /* ... */\n  },\n  {\n    middleware: [basicAuth({ password: \"test\" })],\n  },\n);\n",[212,552,553,570,576,584,591,603,608,612,616,633,637],{"__ignoreMap":233},[237,554,555,558,561,564,567],{"class":239,"line":240},[237,556,557],{"class":261},"import",[237,559,560],{"class":243}," { basicAuth } ",[237,562,563],{"class":261},"from",[237,565,566],{"class":307}," \"h3\"",[237,568,569],{"class":243},";\n",[237,571,572],{"class":239,"line":268},[237,573,575],{"emptyLinePlaceholder":574},true,"\n",[237,577,578,580,582],{"class":239,"line":280},[237,579,244],{"class":243},[237,581,519],{"class":247},[237,583,302],{"class":243},[237,585,586,589],{"class":239,"line":333},[237,587,588],{"class":307},"  \"/secret\"",[237,590,311],{"class":243},[237,592,593,595,597,599,601],{"class":239,"line":350},[237,594,316],{"class":243},[237,596,255],{"class":254},[237,598,258],{"class":243},[237,600,262],{"class":261},[237,602,265],{"class":243},[237,604,605],{"class":239,"line":356},[237,606,607],{"class":376},"    /* ... */\n",[237,609,610],{"class":239,"line":362},[237,611,353],{"class":243},[237,613,614],{"class":239,"line":373},[237,615,359],{"class":243},[237,617,618,621,624,627,630],{"class":239,"line":380},[237,619,620],{"class":243},"    middleware: [",[237,622,623],{"class":247},"basicAuth",[237,625,626],{"class":243},"({ password: ",[237,628,629],{"class":307},"\"test\"",[237,631,632],{"class":243}," })],\n",[237,634,635],{"class":239,"line":385},[237,636,353],{"class":243},[237,638,640],{"class":239,"line":639},11,[237,641,347],{"class":243},[194,643,644,645,648,649,652,653,656],{},"为方便起见，H3 提供了中间件工厂函数 ",[212,646,647],{},"onRequest","、",[212,650,651],{},"onResponse"," 和 ",[212,654,655],{},"onError","：",[228,658,660],{"className":230,"code":659,"language":232,"meta":233,"style":233},"import { onRequest, onResponse, onError } from \"h3\";\n\napp.use(\n  onRequest((event) => {\n    console.log(`[${event.req.method}] ${event.url.pathname}`);\n  }),\n);\n\napp.use(\n  onResponse((response, event) => {\n    console.log(`[${event.req.method}] ${event.url.pathname} ~>`, body);\n  }),\n);\n\napp.use(\n  onError((error, event) => {\n    console.log(\n      `[${event.req.method}] ${event.url.pathname} !! ${error.message}`,\n    );\n  }),\n);\n",[212,661,662,675,679,687,702,746,751,755,759,767,787,825,830,835,840,849,870,879,921,927,932],{"__ignoreMap":233},[237,663,664,666,669,671,673],{"class":239,"line":240},[237,665,557],{"class":261},[237,667,668],{"class":243}," { onRequest, onResponse, onError } ",[237,670,563],{"class":261},[237,672,566],{"class":307},[237,674,569],{"class":243},[237,676,677],{"class":239,"line":268},[237,678,575],{"emptyLinePlaceholder":574},[237,680,681,683,685],{"class":239,"line":280},[237,682,244],{"class":243},[237,684,248],{"class":247},[237,686,302],{"class":243},[237,688,689,692,694,696,698,700],{"class":239,"line":333},[237,690,691],{"class":247},"  onRequest",[237,693,251],{"class":243},[237,695,255],{"class":254},[237,697,258],{"class":243},[237,699,262],{"class":261},[237,701,265],{"class":243},[237,703,704,706,708,710,713,715,718,721,723,726,729,731,733,736,738,741,744],{"class":239,"line":350},[237,705,336],{"class":243},[237,707,274],{"class":247},[237,709,341],{"class":243},[237,711,712],{"class":307},"`[${",[237,714,255],{"class":243},[237,716,717],{"class":307},".",[237,719,720],{"class":243},"req",[237,722,717],{"class":307},[237,724,725],{"class":243},"method",[237,727,728],{"class":307},"}] ${",[237,730,255],{"class":243},[237,732,717],{"class":307},[237,734,735],{"class":243},"url",[237,737,717],{"class":307},[237,739,740],{"class":243},"pathname",[237,742,743],{"class":307},"}`",[237,745,347],{"class":243},[237,747,748],{"class":239,"line":356},[237,749,750],{"class":243},"  }),\n",[237,752,753],{"class":239,"line":362},[237,754,347],{"class":243},[237,756,757],{"class":239,"line":373},[237,758,575],{"emptyLinePlaceholder":574},[237,760,761,763,765],{"class":239,"line":380},[237,762,244],{"class":243},[237,764,248],{"class":247},[237,766,302],{"class":243},[237,768,769,772,774,777,779,781,783,785],{"class":239,"line":385},[237,770,771],{"class":247},"  onResponse",[237,773,251],{"class":243},[237,775,776],{"class":254},"response",[237,778,321],{"class":243},[237,780,255],{"class":254},[237,782,258],{"class":243},[237,784,262],{"class":261},[237,786,265],{"class":243},[237,788,789,791,793,795,797,799,801,803,805,807,809,811,813,815,817,819,822],{"class":239,"line":639},[237,790,336],{"class":243},[237,792,274],{"class":247},[237,794,341],{"class":243},[237,796,712],{"class":307},[237,798,255],{"class":243},[237,800,717],{"class":307},[237,802,720],{"class":243},[237,804,717],{"class":307},[237,806,725],{"class":243},[237,808,728],{"class":307},[237,810,255],{"class":243},[237,812,717],{"class":307},[237,814,735],{"class":243},[237,816,717],{"class":307},[237,818,740],{"class":243},[237,820,821],{"class":307},"} ~>`",[237,823,824],{"class":243},", body);\n",[237,826,828],{"class":239,"line":827},12,[237,829,750],{"class":243},[237,831,833],{"class":239,"line":832},13,[237,834,347],{"class":243},[237,836,838],{"class":239,"line":837},14,[237,839,575],{"emptyLinePlaceholder":574},[237,841,843,845,847],{"class":239,"line":842},15,[237,844,244],{"class":243},[237,846,248],{"class":247},[237,848,302],{"class":243},[237,850,852,855,857,860,862,864,866,868],{"class":239,"line":851},16,[237,853,854],{"class":247},"  onError",[237,856,251],{"class":243},[237,858,859],{"class":254},"error",[237,861,321],{"class":243},[237,863,255],{"class":254},[237,865,258],{"class":243},[237,867,262],{"class":261},[237,869,265],{"class":243},[237,871,873,875,877],{"class":239,"line":872},17,[237,874,336],{"class":243},[237,876,274],{"class":247},[237,878,302],{"class":243},[237,880,882,885,887,889,891,893,895,897,899,901,903,905,907,910,912,914,917,919],{"class":239,"line":881},18,[237,883,884],{"class":307},"      `[${",[237,886,255],{"class":243},[237,888,717],{"class":307},[237,890,720],{"class":243},[237,892,717],{"class":307},[237,894,725],{"class":243},[237,896,728],{"class":307},[237,898,255],{"class":243},[237,900,717],{"class":307},[237,902,735],{"class":243},[237,904,717],{"class":307},[237,906,740],{"class":243},[237,908,909],{"class":307},"} !! ${",[237,911,859],{"class":243},[237,913,717],{"class":307},[237,915,916],{"class":243},"message",[237,918,743],{"class":307},[237,920,311],{"class":243},[237,922,924],{"class":239,"line":923},19,[237,925,926],{"class":243},"    );\n",[237,928,930],{"class":239,"line":929},20,[237,931,750],{"class":243},[237,933,935],{"class":239,"line":934},21,[237,936,347],{"class":243},[938,939,940],"style",{},"html pre.shiki code .slsVL, html code.shiki .slsVL{--shiki-light:#24292E;--shiki-default:#E1E4E8;--shiki-dark:#E1E4E8}html pre.shiki code .shcOC, html code.shiki .shcOC{--shiki-light:#6F42C1;--shiki-default:#B392F0;--shiki-dark:#B392F0}html pre.shiki code .sQHwn, html code.shiki .sQHwn{--shiki-light:#E36209;--shiki-default:#FFAB70;--shiki-dark:#FFAB70}html pre.shiki code .so5gQ, html code.shiki .so5gQ{--shiki-light:#D73A49;--shiki-default:#F97583;--shiki-dark:#F97583}html .light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html.light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html pre.shiki code .sfrk1, html code.shiki .sfrk1{--shiki-light:#032F62;--shiki-default:#9ECBFF;--shiki-dark:#9ECBFF}html pre.shiki code .sCsY4, html code.shiki .sCsY4{--shiki-light:#6A737D;--shiki-default:#6A737D;--shiki-dark:#6A737D}html pre.shiki code .suiK_, html code.shiki .suiK_{--shiki-light:#005CC5;--shiki-default:#79B8FF;--shiki-dark:#79B8FF}",{"title":233,"searchDepth":268,"depth":268,"links":942},[],"使用 H3 中间件拦截请求、响应和错误。","md",{"icon":31},{"icon":31},{"title":28,"description":943},"VUop8uHx2Ym1UDUHDYQzEut3lP5a5jNCu41v3JtRFNY",[950,952],{"title":23,"path":24,"stem":25,"description":951,"icon":26,"children":-1},"每个请求会匹配到一个（最具体的）路由处理器。",{"title":33,"path":34,"stem":35,"description":953,"icon":36,"children":-1},"事件处理器是一个接收 H3Event 并返回响应的函数。",1762531024091]